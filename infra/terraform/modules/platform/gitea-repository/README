# Gitea Repository Terraform Module

This module creates and manages repositories inside a Gitea instance using the
official Terraform Gitea provider. It is designed for GitOps-driven,
infrastructure-as-code environments where repositories must be provisioned
automatically during cluster or platform bootstrap.

The module supports:
- Repository creation (private or public)
- Auto-initializing the repository with a README
- Overriding README.md content
- Setting default branch (`main` or `master`)
- Adding gitignore and license templates
- Enabling/disabling issues, wiki, pull requests
- Configuring merge methods (merge commit, rebase, squash)
- Setting topics/tags
- Archiving/unarchiving repositories

This module is fully cloud-agnostic and works with any Gitea instance reachable
over HTTP/HTTPS.

---

## üöÄ Example Usage

```hcl
module "gitops_repository" {
  source = "../../../modules/gitea/repository"

  name            = "gitops-repo"
  description     = "GitOps repository for ArgoCD"
  private         = true

  readme_content  = "# GitOps Repository\nManaged by Terraform"

  gitignore_template = "Go"
  license            = "MIT"

  enable_issues = true
  enable_wiki   = false
  enable_pulls  = true
}
```

---

## üõ†Ô∏è Requirements

A configured Gitea provider:

```hcl
provider "gitea" {
  base_url  = module.gitea.service_url
  username  = module.gitea.admin_username
  password  = module.gitea.admin_password
  insecure  = true
}
```

---

## üîß Inputs

| Variable | Description | Type | Default |
|---------|-------------|------|---------|
| `name` | Repository name (lowercase alphanumeric + hyphens) | string | ‚Äî |
| `description` | Repository description | string | `""` |
| `private` | Whether the repo is private | bool | `false` |
| `auto_init` | Auto-initialize repository | bool | `true` |
| `default_branch` | Default branch (`main` or `master`) | string | `"main"` |
| `readme_content` | README content (overrides `auto_init`) | string | `""` |
| `gitignore_template` | Gitignore template | string | `""` |
| `license` | License template | string | `""` |
| `enable_issues` | Enable issue tracker | bool | `true` |
| `enable_wiki` | Enable wiki | bool | `false` |
| `enable_pulls` | Enable pull requests | bool | `true` |
| `allow_merge_commits` | Allow merge commits | bool | `true` |
| `allow_rebase` | Allow rebase merges | bool | `true` |
| `allow_squash_merge` | Allow squash merges | bool | `true` |
| `topics` | Repository topics/tags | list(string) | `[]` |
| `archived` | Archive the repository | bool | `false` |

---

## üì§ Outputs

| Output | Description |
|--------|-------------|
| `name` | Repository name |
| `full_name` | `<owner>/<repo>` |
| `html_url` | Browser URL |
| `clone_url` | HTTPS clone URL |
| `ssh_url` | SSH clone URL |
| `id` | Repository ID |
| `default_branch` | Default branch |
| `private` | Whether the repo is private |

---

## üìò Notes

- If `readme_content` is provided, it overrides auto initialization.
- Repository files are created using the `gitea_repository_file` resource.
- This module is safe for ephemeral clusters rebuilt daily.

---

## üß© Best Practice

Use this module together with ArgoCD for fully automated GitOps bootstrapping:

1. Deploy Gitea
2. Use this module to create the GitOps repository
3. Pass the repository URL and credentials to ArgoCD module
4. ArgoCD connects without manual actions

---
